<!DOCTYPE html PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>
<html>
<head>
	<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
	<script type='text/x-handlebars' id="application">
        <header>
            <img src="../html/images/scholagest-logo1-2-small.png" class="app-logo" />
            
            <div>
                <span>{{#link-to "students"}}Etudiants{{/link-to}}</span>
                <span>{{#link-to "teachers"}}Professeurs{{/link-to}}</span>
                <span>{{#link-to "years"}}Volées{{/link-to}}</span>
                <span>{{#link-to "periods"}}Périodes{{/link-to}}</span>
                <span>{{#link-to "newTeacher"}}Nouveau Professeur{{/link-to}}</span>
            </div>
        </header>
        
        <div>
            {{outlet}}
        </div>
        
        <footer>
            
        </footer>
	</script>
	<script type='text/x-handlebars' id="students">
        <ul>
            {{#each student in controller}}
                <li>
                    {{#link-to "student" student}}
                        {{student.fullName}}
                    {{/link-to}}
                </li>
            {{else}}
                <li>Pas d'élèves...</li>
            {{/each}}
        </ul>

        {{outlet}}
	</script>
    <script type='text/x-handlebars' id="student">
        <h2>{{firstName}} {{lastName}}</h2>
        
        {{partial "studentPersonal"}}
        {{partial "studentMedical"}}
    </script>
    <script type='text/x-handlebars' id="studentPersonal">
        <h2>Informations personnelles</h2>
        
        <table>
            <tr>
                <td>Prénom</td><td>{{input value=firstName}}</td>
            </tr>
            <tr>
                <td>Nom</td><td>{{input value=lastName}}</td>
            </tr>
            <tr>
                <td>Rue</td><td>{{input value=personal.street}}</td>
            </tr>
            <tr>
                <td>Code postal</td><td>{{input value=personal.postcode}}</td>
            </tr>
            <tr>
                <td>Ville</td><td>{{input value=personal.city}}</td>
            </tr>
            <tr>
                <td>Religion</td><td>{{input value=personal.religion}}</td>
            </tr>
        </table>
    </script>
    <script type='text/x-handlebars' id="studentMedical">
        <h2>Informations personnelles</h2>
        
        <table>
            <tr>
                <td>Docteur</td><td>{{input value=medical.doctor}}</td>
            </tr>
        </table>
    </script>
	
	<script type='text/x-handlebars' id="teachers">
        <h1>Professeurs</h1>
        <ul>
            {{#each teacher in controller}}
                <li>
                    {{#link-to "teacher" teacher}}
                        {{teacher.fullName}}
                    {{/link-to}}
                </li>
            {{else}}
                <li>Pas de professeur...</li>
            {{/each}}
        </ul>

        {{outlet}}
	</script>
    <script type='text/x-handlebars' id="teacher">
        <h2>{{fullName}}</h2>
        
        <table>
            <tr>
                <td>Prénom</td><td>{{input value=firstName}}</td>
            </tr>
            <tr>
                <td>Nom</td><td>{{input value=lastName}}</td>
            </tr>
            <tr>
                <td>Email</td><td>{{input value=detail.email}}</td>
            </tr>
            <tr>
                <td>Adresse</td><td>{{input value=detail.address}}</td>
            </tr>
            <tr>
                <td>Téléphone</td><td>{{input value=detail.phone}}</td>
            </tr>
        </table>

        <button {{action save}}>Enregistrer</button>
    </script>
    <script type='text/x-handlebars' id="newTeacher">
        <h2>Nouveau professeur</h2>
        
        <table>
            <tr>
                <td>Prénom</td><td>{{input value=firstName}}</td>
            </tr>
            <tr>
                <td>Nom</td><td>{{input value=lastName}}</td>
            </tr>
            <tr>
                <td>Email</td><td>{{input value=email}}</td>
            </tr>
            <tr>
                <td>Adresse</td><td>{{input value=address}}</td>
            </tr>
            <tr>
                <td>Téléphone</td><td>{{input value=phone}}</td>
            </tr>
        </table>

        <button {{action create}} >Enregistrer</button>
    </script>
    
    <script type='text/x-handlebars' id="years">
        <h2>Volées</h2>
        
        <ul>
            {{#each year in controller}}
                <li>{{year.name}}</li>
                {{#each class in year.classes}}
                    <li>
                        {{#link-to "class" class}}
                            {{class.name}}
                        {{/link-to}}
                    </li>
                    {{! <li>{{class.name</li> }}
                {{/each}}
            {{else}}
                <li>Pas de volée...</li>
            {{/each}}
        </ul>

        {{outlet}}
    </script>
    <script type='text/x-handlebars' id="class">
        <h1>Classe {{name}}</h1>

        <table>
            <tr>
                <td>Nom</td><td>{{input value=name}}</td>
            </tr>
            <tr>
                <td>Elèves</td>
                <td>
                    <ul>
                        {{#each student in students}}
                            <li>{{student.fullName}}</li>
                        {{else}}
                            <li>Pas d'élève</li>
                        {{/each}}
                    </ul>
                </td>
            </tr>
            <tr>
                <td>Professeurs</td>
                <td>
                    <ul>
                        {{#each teacher in teachers}}
                            <li>{{teacher.fullName}}</li>
                        {{else}}
                            <li>Pas de professeur</li>
                        {{/each}}
                    </ul>
                </td>
            </tr>
        </table>
    </script>
    
    <script type='text/x-handlebars' id="periods">
        <h2>Périodes</h2>
        
        <ul>
            {{#each period in controller}}
                <li>
                    {{#link-to "period" period}}
                        {{period.name}}
                    {{/link-to}}
                </li>
            {{else}}
                <li>Pas de période...</li>
            {{/each}}
        </ul>

        {{outlet}}
    </script>
    <script type='text/x-handlebars' id="period">
        <h2>{{name}}</h2>
        
        <ul>
            {{#each branch in branches}}
                <li>
                    {{#link-to "branch" branch}}
                        {{branch.name}}
                    {{/link-to}}
                </li>
            {{else}}
                <li>Pas de branche...</li>
            {{/each}}
        </ul>

        {{outlet}}
    </script>
    <script type='text/x-handlebars' id="branch">
        <h2>{{name}}</h2>
        
        <table>
            <tr>
                <td></td>
                {{#each exam in exams}}
                    <td>{{exam.name}}</td>
                {{/each}}
            </tr>
            
            {{#each studentResult in studentResults}}
                <tr>
                    <td>{{studentResult.student.fullName}}</td>
                    {{#each result in studentResult.results}}
                        <td>{{input value=result.grade}}</td>
                    {{/each}}
                </tr>
            {{/each}}
        </table>

        <button {{action save}} >Enregistrer</button>
    </script>
    <!-- {{#each student in period.clazz.students}}
                <tr>
                    <td>{{student.fullName}}</td>
                    {{#each exam in exams}}
                        <td>{{resultView exam student.id}}</td>
                    {{/each}}
                </tr>
            {{/each}} -->
	<!-- 
        {{! {{#each attribute in metadata }}
        {{!     {{attribute.name }}
        {{!     {{! {{input value=attribute.value }}
        {{!     {{view Scholagest.AutoTextField name=attribute.name }}
        {{!     <br /> }}
        {{! {{/each }}
        
        {{! <button {{action "delete"}}>Delete</button> }} -->
	<script src='../jquery-1.10.2.js'></script>
	<script src='../handlebars-1.1.2.js'></script>
	<script src='../ember.js'></script>
	<script src='../ember-data.js'></script>
	<script type='text/javascript'>
		   Scholagest = Ember.Application.create({
			   LOG_TRANSITIONS: true
		   });

//            Scholagest.TeacherSerializer = DS.RESTSerializer.extend({
//                serializeBelongsTo: function(record, json, relationship) {
//                    var key = relationship.key;
            
//                    var belongsTo = Ember.get(record, key);
            
//                    key = this.keyForRelationship ? this.keyForRelationship(key, "belongsTo") : key;
            
//                    // .get('content') is required because of the async in the model definition.
//                    json[key] = Ember.isNone(belongsTo) ? belongsTo : belongsTo.get('content').toJSON();
//                }
//            });
           Scholagest.ApplicationAdapter = DS.RESTAdapter;
           DS.RESTAdapter.reopen({
               host: 'http://localhost:8080',
               namespace: 'scholagest-app/services'
           });
		   
		   Scholagest.Router.map(function() {
	           this.resource('students', function() {
	        	   this.resource('student', { path: '/:student_id' }, function() {});
	           });
               this.resource('teachers', function() {
                   this.resource('teacher', { path: '/:teacher_id' }, function() {});
               });
               this.resource('years', function() {
                   this.resource('class', { path: '/:class_id' }, function() {});
               });
               this.resource('periods', function() {
                   this.resource('period', { path: '/:period_id' }, function() {
                	   this.resource('branch', { path: '/:branch_id' }, function() {});
                   });
               });
               this.resource('newTeacher', function() {});
		   });
		   
		   Ember.Handlebars.helper('resultView', function(exam, student_id) {
			   var result = exam.getResult(student_id);
			   if (result == null) {
				   return new Handlebars.SafeString('no result');
			   } else {
                   //return new Handlebars.SafeString('<input type="text" {{value=}} />');
                   return new Handlebars.SafeString('<input type="text" value="' + result.get('grade') + '" />');
			   }
		   });
	</script>
    <script src='js/model.js'></script>
    <script src='js/index.js'></script>
    <script src='js/year.js'></script>
    <script src='js/class.js'></script>
    <script src='js/student.js'></script>
    <script src='js/teacher.js'></script>
    <script src='js/branch.js'></script>
	
	<title>Scholagest</title>
</head>
<body>
</body>
</html>